---
import Mdoc from "@/mdoc-plugin/Mdoc.astro";
import { read } from "@/mdoc-plugin/reader";
import { CONSTANTS } from "@/utilities/env";

export async function getStaticPaths() {
	const allPosts = await read({ dir: CONSTANTS.content, type: "post" });
	const posts = allPosts.filter(
		({ frontmatter }) => frontmatter.draft !== true
	);

	return posts.map((post, i) => ({
		params: {
			id: post.id,
			post: post.renderableTree,
			frontmatter: post.frontmatter,
			pagination: {
				previous: i !== 0 ? posts.at(i - 1) : undefined,
				next: posts.at(i + 1),
			},
		},
	}));
}

const { post } = Astro.params;
---

<Mdoc content={post!} />
